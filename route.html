<!-- route.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Маршрут — Огненная Камчатка</title>
  <link rel="stylesheet" href="style/style.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <!-- EmailJS SDK -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <style>
    #map {
      height: 75vh;
      width: 100%;
      border-radius: 12px;
      margin-top: 1.5rem;
      box-shadow: 0 6px 25px rgba(0, 0, 0, 0.12);
    }

    .map-controls {
      text-align: center;
      margin: 1.5rem 0;
    }

    .btn-map {
      background: var(--accent);
      color: white;
      border: none;
      padding: 0.6rem 1.4rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      margin: 0 0.6rem;
      font-size: 1rem;
      transition: all 0.25s ease;
    }

    .btn-map:hover {
      background: transparent;
      color: var(--accent);
      border: 2px solid var(--accent);
    }

    /* Стили для маршрута */
    .route-intro {
      margin-bottom: 3rem;
    }

    .day-card {
      background: rgba(255, 255, 255, 0.04);
      border-left: 4px solid var(--accent);
      padding: 1.2rem;
      margin-bottom: 1.5rem;
      border-radius: 0 8px 8px 0;
    }

    .day-card h3 {
      margin-top: 0;
      color: var(--accent);
    }

    .logistics-section {
      margin: 3rem 0;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .transport-list {
      list-style: none;
      padding: 0;
    }

    .transport-list li {
      padding: 0.6rem 0;
      border-bottom: 1px dashed rgba(255, 255, 255, 0.15);
    }

    .transport-list li:last-child {
      border-bottom: none;
    }

    .price-tag {
      font-weight: bold;
      color: var(--accent);
    }

    /* Выбор жилья */
    .hotel-options {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-top: 1rem;
    }

    .hotel-card {
      background: rgba(255, 255, 255, 0.04);
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .hotel-card:hover {
      transform: translateY(-4px);
      border-color: rgba(46, 204, 113, 0.5);
    }

    .hotel-card.selected {
      border-color: var(--accent);
      background: rgba(46, 204, 113, 0.08);
    }

    .hotel-img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      background: #2c3e50;
    }

    .hotel-info {
      padding: 1rem;
    }

    .hotel-info h3 {
      margin: 0 0 0.4rem;
      color: var(--accent);
    }

    .hotel-price {
      font-weight: bold;
      color: #f1c40f;
      margin: 0.4rem 0;
    }

    .btn-book {
      margin-top: 0.8rem;
      background: var(--accent);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      width: 100%;
    }

    .btn-book:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* === СВЕТЛЫЙ КАЛЬКУЛЯТОР С РАМКОЙ И ЗЕЛЁНЫМ АКЦЕНТОМ === */
.calculator-form {
  display: grid;
  gap: 1.2rem;
  max-width: 500px;
  margin: 2rem auto;
  padding: 2rem;
  background: white; /* белый фон */
  border: 2px solid #e0e0e0; /* светлая рамка */
  border-radius: 14px;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08); /* мягкая тень для выделения */
  color: #222; /* тёмно-серый, почти чёрный */
}

.calculator-form h2 {
  text-align: center;
  margin-top: 0;
  margin-bottom: 1rem;
  font-size: 1.5rem;
  color: #222;
  position: relative;
}

/* Зелёная полоска под заголовком */
.calculator-form h2::after {
  content: "";
  display: block;
  width: 50px;
  height: 3px;
  background: #2ecc71;
  margin: 0.6rem auto 0;
  border-radius: 2px;
}

.form-row label {
  margin-bottom: 0.4rem;
  font-weight: 600;
  color: #333;
}

.form-row input,
.form-row select {
  padding: 0.7rem;
  border-radius: 10px;
  border: 1px solid #ccc;
  background: white;
  color: #222;
  font-size: 1rem;
  transition: border-color 0.25s;
}

.form-row input:focus,
.form-row select:focus {
  outline: none;
  border-color: #2ecc71;
  box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.15);
}

.checkbox-item {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  cursor: pointer;
  color: #333;
  margin: 0.3rem 0;
}

.checkbox-item input {
  width: auto;
  margin: 0;
  accent-color: #2ecc71; /* зелёная галочка */
}

/* Кнопка — яркая, зелёная */
#book-btn {
  margin-top: 1rem;
  background: #2ecc71;
  color: white;
  border: none;
  padding: 0.75rem;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 700;
  font-size: 1.1rem;
  width: 100%;
  transition: background 0.25s, transform 0.2s;
  box-shadow: 0 4px 10px rgba(46, 204, 113, 0.2);
}

#book-btn:hover:not(:disabled) {
  background: #27ae60;
  transform: translateY(-2px);
}

#book-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

/* Блок результата — с зелёной меткой */
.cost-result {
  margin-top: 1.2rem;
  padding: 1.2rem;
  background: #f9f9f9;
  border-radius: 10px;
  border-left: 4px solid #2ecc71;
}

.cost-result h3 {
  margin: 0 0 0.5rem;
  color: #222;
  font-size: 1.2rem;
}

#cost-breakdown {
  font-size: 0.95rem;
  line-height: 1.6;
  color: #555;
  margin: 0;
}

    /* Всплывающее уведомление */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(46, 204, 113, 0.95);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.4s ease;
      z-index: 1000;
    }

    .notification.show {
      opacity: 1;
      transform: translateX(0);
    }
  </style>
</head>
<body>

  <header>
    <nav>
      <ul>
        <li><a href="index.html">Главная</a></li>
        <li><a href="guide.html">Путеводитель</a></li>
        <li><a href="route.html">Маршрут</a></li>
        <li><a href="gallery.html">Галерея</a></li>
      </ul>
    </nav>
  </header>

  <div class="container">
    <h1>Первое знакомство с Камчаткой</h1>
    
    <div class="route-intro">
      <p>6-дневный тур для первого визита: от черных пляжей до вулканических высот и термальных источников. Все точки доступны в летний сезон (июль–август).</p>
    </div>

    <!-- День за днём -->
    <section class="itinerary">
      <h2>Подробный маршрут</h2>
      <div class="day-card">
        <h3>День 1 — Прибытие</h3>
        <p>Аэропорт Елизово → заселение в отель → адаптация.</p>
      </div>
      <div class="day-card">
        <h3>День 2 — Бухта и пляж</h3>
        <p>Смотровая «Три Брата» → Авачинская губа → Халактырский пляж.</p>
      </div>
      <div class="day-card">
        <h3>День 3 — Вулканические склоны</h3>
        <p>Сопка Мишенная → Перевал Авачинский (1199 м).</p>
      </div>
      <div class="day-card">
        <h3>День 4 — Восхождение</h3>
        <p>Подъём на Авачинскую сопку (2741 м) — для начинающих альпинистов.</p>
      </div>
      <div class="day-card">
        <h3>День 5 — Водопад и источники</h3>
        <p>Водопад «Снежный барс» → Верхне-Паратунские термальные источники.</p>
      </div>
      <div class="day-card">
        <h3>День 6 — Вулкан Вачкажец</h3>
        <p>Лёгкий trekking на Вачкажец (1556 м). Вулкан Корякский и Долина гейзеров требуют дополнительных дней и вертолёта — не включены в базовый маршрут.</p>
      </div>
    </section>

    <!-- === ВЫБОР ЖИЛЬЯ === -->
    <section class="hotels-section logistics-section">
      <h2>Выберите и забронируйте жильё</h2>
      <p>Все варианты находятся в зоне доступности к точкам маршрута.</p>
      
      <div class="hotel-options" id="hotel-options">
        <!-- Отели будут добавлены динамически -->
      </div>

     
    </section>

    <!-- Трансфер и логистика -->
    <section id="transport" class="logistics-section">
      <h2>Как добраться: трансфер и стоимость</h2>
      <ul class="transport-list">
        <li><strong>Аэропорт → отель</strong>: такси ~<span class="price-tag">600 ₽</span> (5 мин)</li>
        <li><strong>Отель → Халактырский пляж (туда-обратно)</strong>: ~<span class="price-tag">3 000 ₽</span></li>
        <li><strong>Отель → Паратунка (водопад + источники)</strong>: ~<span class="price-tag">4 500 ₽</span> туда-обратно</li>
        <li><strong>Трансфер к старту тропы</strong>: ~<span class="price-tag">2 000–2 500 ₽</span> в одну сторону</li>
        <li><strong>Аренда внедорожника с водителем</strong>: от <span class="price-tag">6 000 ₽/день</span></li>
        <li><strong>Гид на Авачинскую сопку</strong> (группа до 5 чел): <span class="price-tag">8 000 ₽</span></li>
      </ul>
      <p class="note">Цены ориентировочные.</p>
    </section>

    <!-- Интерактивный калькулятор стоимости -->
<section id="calculator" class="logistics-section">
  <form id="trip-calculator" class="calculator-form">
    <h2>Рассчитайте стоимость поездки</h2>

    <div class="form-row">
      <label for="checkin">Заезд:</label>
      <input type="date" id="checkin" required>
    </div>
    <div class="form-row">
      <label for="checkout">Выезд:</label>
      <input type="date" id="checkout" required>
    </div>
    <div class="form-row">
      <label for="adults">Взрослые:</label>
      <select id="adults" required>
        <option value="1">1</option>
        <option value="2" selected>2</option>
        <option value="3">3</option>
        <option value="4">4</option>
      </select>
    </div>
    <div class="form-row">
      <label for="children">Дети (до 12 лет):</label>
      <select id="children">
        <option value="0" selected>0</option>
        <option value="1">1</option>
        <option value="2">2</option>
      </select>
    </div>
    <div class="form-row">
      <label for="user-email">Ваш email:</label>
      <input type="email" id="user-email" required placeholder="ivan@example.com">
    </div>

    <div class="form-row checkboxes">
      <label>Трансфер и гиды (опционально):</label>
      <label class="checkbox-item">
        <input type="checkbox" id="transfer-airport"> Аэропорт ↔ отель (600 ₽)
      </label>
      <label class="checkbox-item">
        <input type="checkbox" id="transfer-halaktyr"> Халактырский пляж (3 000 ₽)
      </label>
      <label class="checkbox-item">
        <input type="checkbox" id="transfer-paratunka"> Паратунка: водопад + источники (4 500 ₽)
      </label>
      <label class="checkbox-item">
        <input type="checkbox" id="guide-avachinsky"> Гид на Авачинскую сопку (8 000 ₽)
      </label>
    </div>

    <div id="cost-result" class="cost-result">
      <h3>Итоговая стоимость: <span id="total-amount">—</span> ₽</h3>
      <p id="cost-breakdown"></p>
    </div>

    <button id="book-btn" disabled>Забронировать выбранный отель</button>
  </form>
</section>

    <!-- Карта -->
    <div class="map-controls">
      <button class="btn-map" id="show-russia">Показать Россию</button>
      <button class="btn-map" id="show-kamchatka">Показать Камчатку</button>
    </div>

    <div id="map"></div>
  </div>

  <div id="notification" class="notification">Запрос отправлен!</div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>
  <script>
    // === EmailJS: инициализация после полной загрузки страницы ===
document.addEventListener('DOMContentLoaded', function() {
  emailjs.init("KmJkos_4wQ7IMna2J");
});

    // === Данные отелей ===
const hotels = [
  {
    id: 'kamchatka-shale',
    name: 'Камчатка Шале',
    location: [53.1667, 158.4583],
    price: 7000,
    img: 'https://avatars.mds.yandex.net/get-altay/9368060/2a000001899e5422a8a415a1350e82bb6333/orig', // Реальное фото
    desc: 'Современный отель в Елизово, 5 мин от аэропорта.',
    bookingUrl: 'https://www.booking.com/hotel/ru/kamchatka-shale.ru.html'
  },
  {
    id: 'avacha-hotel',
    name: 'Отель «Авача»',
    location: [52.99, 158.65],
    price: 8500,
    img: 'https://s.101hotelscdn.ru/uploads/image/hotel_image/4012/5587058.jpg', // Реальное фото
    desc: 'Центр Петропавловска, вид на бухту.',
    bookingUrl: 'https://www.booking.com/hotel/ru/avacha-petropavlovsk-kamchatskiy.ru.html'
  },
  {
    id: 'nalychevo-lodge',
    name: 'Эко-лодж «Налычево»',
    location: [53.10, 158.10],
    price: 6000,
    img: 'https://volcanoesland.com/upload/medialibrary/332/332ce8ba1c5e7f16e96d2b450f32fb59.JPG', // Реальное фото
    desc: 'В тайге, у подножия вулканов.',
    bookingUrl: 'https://www.booking.com/hotel/ru/eco-lodge-nalychovo.ru.html'
  }
];

    const stops = [
      { name: "Три Брата", lat: 52.97, lng: 158.65 },
      { name: "Халактырский пляж", lat: 52.8667, lng: 158.2333 },
      { name: "Сопка Мишенная", lat: 52.94, lng: 158.7 },
      { name: "Перевал Авачинский", lat: 52.93, lng: 158.82 },
      { name: "Авачинская сопка", lat: 53.25, lng: 158.8333 },
      { name: "Снежный барс", lat: 52.9167, lng: 158.3333 },
      { name: "Паратунские источники", lat: 52.91, lng: 158.33 },
      { name: "Вачкажец", lat: 52.65, lng: 157.83 }
    ];

    let selectedHotel = null;
    let selectedHotelMarker = null;
    let stopMarkers = [];

    const map = L.map('map').setView([62, 95], 3);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
    map.attributionControl.setPrefix(false);

    const russiaMarker = L.marker([59.0, 161.0]).addTo(map);
    russiaMarker.bindPopup("<b>Камчатский край</b><br>Нажмите, чтобы увидеть маршрут").openPopup();

    const hotelOptionsEl = document.getElementById('hotel-options');
    hotels.forEach(hotel => {
      const card = document.createElement('div');
      card.className = 'hotel-card';
      card.innerHTML = `
        <img src="${hotel.img}" alt="${hotel.name}" class="hotel-img">
        <div class="hotel-info">
          <h3>${hotel.name}</h3>
          <p>${hotel.desc}</p>
          <p class="hotel-price">От ${hotel.price.toLocaleString('ru')} ₽ / ночь</p>
        </div>
      `;
      card.addEventListener('click', () => {
        document.querySelectorAll('.hotel-card').forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');
        selectedHotel = hotel;
        document.getElementById('book-btn').disabled = false;
        calculateCost();
      });
      hotelOptionsEl.appendChild(card);
    });

    // === Калькулятор ===
    const checkinEl = document.getElementById('checkin');
    const checkoutEl = document.getElementById('checkout');
    const adultsEl = document.getElementById('adults');
    const childrenEl = document.getElementById('children');
    const userEmailEl = document.getElementById('user-email');
    const checkboxes = {
      transferAirport: document.getElementById('transfer-airport'),
      transferHalaktyr: document.getElementById('transfer-halaktyr'),
      transferParatunka: document.getElementById('transfer-paratunka'),
      guideAvachinsky: document.getElementById('guide-avachinsky')
    };
    const totalAmountEl = document.getElementById('total-amount');
    const costBreakdownEl = document.getElementById('cost-breakdown');

    const today = new Date();
    const defaultCheckin = new Date(today);
    const defaultCheckout = new Date(today);
    defaultCheckout.setDate(today.getDate() + 6);
    const formatDate = (d) => d.toISOString().split('T')[0];
    checkinEl.value = formatDate(defaultCheckin);
    checkoutEl.value = formatDate(defaultCheckout);

    function calculateCost() {
      const checkin = new Date(checkinEl.value);
      const checkout = new Date(checkoutEl.value);
      const nights = (checkout - checkin) / (1000 * 60 * 60 * 24);
      const roomPricePerNight = selectedHotel ? selectedHotel.price : 7000;
      const accommodationCost = Math.max(0, nights) * roomPricePerNight;

      let transferCost = 0;
      if (checkboxes.transferAirport.checked) transferCost += 600;
      if (checkboxes.transferHalaktyr.checked) transferCost += 3000;
      if (checkboxes.transferParatunka.checked) transferCost += 4500;
      if (checkboxes.guideAvachinsky.checked) transferCost += 8000;

      const total = Math.round(accommodationCost + transferCost);
      let breakdown = `<strong>Жильё:</strong> ${nights} ноч. × ${roomPricePerNight.toLocaleString('ru')} ₽ = ${Math.round(accommodationCost).toLocaleString('ru')} ₽<br>`;
      if (transferCost > 0) {
        breakdown += `<strong>Трансфер/гиды:</strong> ${transferCost.toLocaleString('ru')} ₽<br>`;
      }

      totalAmountEl.textContent = total.toLocaleString('ru');
      costBreakdownEl.innerHTML = breakdown;
    }

    [checkinEl, checkoutEl, adultsEl, childrenEl].forEach(el => {
      el.addEventListener('change', calculateCost);
    });
    Object.values(checkboxes).forEach(cb => {
      cb.addEventListener('change', calculateCost);
    });

    calculateCost();

    // === Основная логика бронирования ===
    document.getElementById('book-btn').addEventListener('click', () => {
      if (!selectedHotel || !userEmailEl.checkValidity()) {
        alert('Пожалуйста, выберите отель и укажите корректный email.');
        return;
      }

      // Обновление карты
      if (selectedHotelMarker) map.removeLayer(selectedHotelMarker);
      stopMarkers.forEach(m => map.removeLayer(m));
      stopMarkers = [];

      selectedHotelMarker = L.marker(selectedHotel.location).addTo(map);
      selectedHotelMarker.bindPopup(`<b>${selectedHotel.name}</b><br>Ваша база`).openPopup();

      stopMarkers = stops.map(stop => {
        const m = L.marker([stop.lat, stop.lng]).addTo(map);
        m.bindPopup(stop.name);
        return m;
      });

      map.setView(selectedHotel.location, 9);

      // Данные для письма
      const templateParams = {
        to_email: userEmailEl.value,
        hotel: selectedHotel.name,
        checkin: checkinEl.value,
        checkout: checkoutEl.value,
        adults: adultsEl.value,
        children: childrenEl.value
      };

      // Отправка через EmailJS
      emailjs.send('service_45azbgh', 'template_yl2fqvs', templateParams)
        .then(() => {
          const notification = document.getElementById('notification');
          notification.textContent = "Письмо с подтверждением отправлено на ваш email!";
          notification.classList.add('show');
          setTimeout(() => notification.classList.remove('show'), 4000);
        })
        .catch(error => {
          console.error('Ошибка EmailJS:', error);
          alert('Не удалось отправить письмо. Проверьте подключение.');
        });

      
    });

    // === Управление картой ===
    function showRussia() {
      map.setView([62, 95], 3);
      if (selectedHotelMarker) map.removeLayer(selectedHotelMarker);
      stopMarkers.forEach(m => map.removeLayer(m));
      stopMarkers = [];
    }

    function showKamchatka() {
      if (selectedHotel) {
        map.setView(selectedHotel.location, 9);
      } else {
        map.setView([53.0, 158.5], 8);
      }
    }

    russiaMarker.on('click', showKamchatka);
    document.getElementById('show-russia').addEventListener('click', showRussia);
    document.getElementById('show-kamchatka').addEventListener('click', showKamchatka);
  </script>

  <footer>
    <p>© 2025 Можерина С.Д. «Огненная Камчатка» — интерактивный путеводитель</p>
  </footer>

</body>
</html>